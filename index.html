<!DOCTYPE html>
<html lang="es">
    <meta charset="UTF-8">
    <head>
        <title>Juego de atrapar</title>
        <style>
            body {
                text-align: center;
                background-color: #222;
                color: white;
                font-family: sans-serif;
            }

            #gameArea {
                position: relative;
                width: 500px;
                height: 400px;
                background-color: #333;
                margin: 20px auto;
                border: 2px solid white;
            }

            #square {
                position: absolute;
                width: 50px;
                height: 50px;
                background-color: red;
                display: none;
                cursor: pointer;
            }
        </style>
    </head>
    <body>
        <h1>Atrapa el cuadrado</h1>
        <p>Haz click en el cuadrado rojo para ganar puntos</p>
        <div id="gameArea">
            <div id="square"></div>
        </div>
       <script>
            const square = document.getElementById("square");
            const gameArea = document.getElementById("gameArea");

            // --- Zona de puntuaciÃ³n ---
            const scoreDisplay = document.createElement("div");
            scoreDisplay.style.fontSize = "24px";
            scoreDisplay.style.marginTop = "10px";
            document.body.appendChild(scoreDisplay);

            // --- Zona de mensajes ---
            const messageBox = document.createElement("div");
            messageBox.style.marginTop = "10px";
            messageBox.style.color = "yellow";
            messageBox.style.minHeight = "24px";
            document.body.appendChild(messageBox);

            function showMessage(text, color = "yellow") {
                messageBox.textContent = text;
                messageBox.style.color = color;
                clearTimeout(showMessage.timeout);
                showMessage.timeout = setTimeout(() => (messageBox.textContent = ""), 2000);
            }

            // --- Zona de botones en columna ---
            const buttonArea = document.createElement("div");
            buttonArea.style.marginTop = "10px";
            buttonArea.style.display = "flex";
            buttonArea.style.flexDirection = "column"; // vertical
            buttonArea.style.alignItems = "flex-start";
            buttonArea.style.gap = "8px";
            document.body.appendChild(buttonArea);

            const resetButton = document.createElement("button");
            resetButton.textContent = "Reiniciar progreso";

            const menuButton = document.createElement("button");
            menuButton.textContent = "MenÃº";
            menuButton.style.display = "none";

            const inventoryButton = document.createElement("button");
            inventoryButton.textContent = "Inventario";
            inventoryButton.style.display = "none";

            buttonArea.append(resetButton, menuButton, inventoryButton);

            // --- Tienda ---
            const shop = document.createElement("div");
            shop.style.marginTop = "15px";
            document.body.appendChild(shop);

            // --- Panel de Inventario ---
            const inventoryPanel = document.createElement("div");
            inventoryPanel.style.position = "fixed";
            inventoryPanel.style.top = "50%";
            inventoryPanel.style.left = "50%";
            inventoryPanel.style.transform = "translate(-50%, -50%)";
            inventoryPanel.style.backgroundColor = "rgba(0, 0, 0, 0.9)";
            inventoryPanel.style.color = "white";
            inventoryPanel.style.padding = "20px";
            inventoryPanel.style.border = "2px solid white";
            inventoryPanel.style.borderRadius = "10px";
            inventoryPanel.style.display = "none";
            inventoryPanel.style.textAlign = "center";
            inventoryPanel.style.zIndex = "10";

            const inventoryTitle = document.createElement("h2");
            inventoryTitle.textContent = "ðŸŽ’ Inventario";
            inventoryPanel.appendChild(inventoryTitle);

            const inventoryContent = document.createElement("div");
            inventoryContent.style.marginTop = "10px";
            inventoryPanel.appendChild(inventoryContent);

            const closeInventoryBtn = document.createElement("button");
            closeInventoryBtn.textContent = "Cerrar";
            closeInventoryBtn.style.marginTop = "15px";
            inventoryPanel.appendChild(closeInventoryBtn);

            document.body.appendChild(inventoryPanel);

            // --- Variables ---
            let score = 0;
            let hasWoodSword = false;
            let startTime;
            let timer;
            let gameActive = false;

            // --- Guardar/cargar progreso ---
            function loadProgress() {
                const savedScore = localStorage.getItem("score");
                const savedSword = localStorage.getItem("woodSword");
                if (savedScore) score = parseInt(savedScore);
                if (savedSword === "true") hasWoodSword = true;
                updateScore(0);
                updateShop();
            }

            function saveProgress() {
                localStorage.setItem("score", score);
                localStorage.setItem("woodSword", hasWoodSword);
            }

            // --- Mostrar cuadrado ---
            function showSquare() {
                if (!gameActive) return;

                const x = Math.random() * (gameArea.clientWidth - 50);
                const y = Math.random() * (gameArea.clientHeight - 50);
                square.style.left = `${x}px`;
                square.style.top = `${y}px`;
                square.style.display = "block";
                startTime = Date.now();

                timer = setTimeout(() => {
                    square.style.display = "none";
                    showSquare();
                    updateScore(0);
                }, 1500);
            }

            // --- Actualizar puntuaciÃ³n ---
            function updateScore(points) {
                score += points;
                scoreDisplay.textContent = `Monedas: ${score}`;
                saveProgress();
                updateShop();
            }

            // --- Tocar el cuadrado ---
            square.addEventListener("pointerdown", () => {
                if (!gameActive) return;
                const reaction = Date.now() - startTime;
                clearTimeout(timer);
                square.style.display = "none";

                let points = 0;
                if (reaction <= 600) points = 3;
                else if (reaction <= 1000) points = 2;
                else if (reaction <= 1500) points = 1;

                if (hasWoodSword) points += 1;

                updateScore(points);
                showMessage(`+${points} monedas`, hasWoodSword ? "cyan" : "lime");
                showSquare();
            });

            // --- Tienda ---
            function updateShop() {
                shop.innerHTML = "";
                const sword = document.createElement("div");

                if (!hasWoodSword) {
                    sword.textContent = "Espada de madera - Precio: 20 monedas";
                    const buyBtn = document.createElement("button");
                    buyBtn.textContent = "Comprar";
                    buyBtn.style.marginLeft = "10px";

                    buyBtn.onclick = () => {
                        if (score >= 20) {
                            score -= 20;
                            hasWoodSword = true;
                            updateScore(0);
                            showMessage("Â¡Has comprado la espada de madera!", "cyan");
                        } else {
                            showMessage("No tienes suficientes monedas.", "red");
                        }
                    };
                    sword.appendChild(buyBtn);
                } else {
                    sword.textContent = "âœ… Espada de madera (Activa: +1 moneda por toque)";
                    sword.style.color = "cyan";
                }
                shop.appendChild(sword);
            }

            // --- BotÃ³n de reinicio ---
            resetButton.addEventListener("click", () => {
                score = 0;
                hasWoodSword = false;
                localStorage.clear();
                updateScore(0);
                showMessage("Progreso reiniciado", "orange");
            });

            // --- MenÃº principal ---
            const menu = document.createElement("div");
            menu.style.position = "absolute";
            menu.style.top = "0";
            menu.style.left = "0";
            menu.style.width = "100%";
            menu.style.height = "100%";
            menu.style.backgroundColor = "rgba(0, 0, 0, 0.9)";
            menu.style.display = "flex";
            menu.style.flexDirection = "column";
            menu.style.justifyContent = "center";
            menu.style.alignItems = "center";
            menu.style.gap = "15px";
            menu.style.color = "white";
            menu.style.fontSize = "20px";
            document.body.appendChild(menu);

            const title = document.createElement("h1");
            title.textContent = "ðŸŽ® Atrapa el Cuadrado";
            menu.appendChild(title);

            const startBtn = document.createElement("button");
            startBtn.textContent = "Empezar juego";
            menu.appendChild(startBtn);

            const rulesBtn = document.createElement("button");
            rulesBtn.textContent = "Reglas";
            menu.appendChild(rulesBtn);

            startBtn.onclick = () => {
                menu.style.display = "none";
                gameActive = true;
                menuButton.style.display = "block";
                inventoryButton.style.display = "block";
                showSquare();
                showMessage("Â¡Empieza el juego!", "lime");
            };

            rulesBtn.onclick = () => {
                showMessage("Toca el cuadrado lo mÃ¡s rÃ¡pido posible. Usa las monedas para comprar mejoras.", "white");
            };

            menuButton.onclick = () => {
                gameActive = false;
                clearTimeout(timer);
                square.style.display = "none";
                menu.style.display = "flex";
                menuButton.style.display = "none";
                inventoryButton.style.display = "none";
                inventoryPanel.style.display = "none";
                showMessage("Juego pausado", "orange");
            };

            // --- Inventario visual ---
            inventoryButton.onclick = toggleInventory;

            function toggleInventory() {
                if (inventoryPanel.style.display === "block") {
                    inventoryPanel.style.display = "none";
                } else {
                    updateInventory();
                    inventoryPanel.style.display = "block";
                }
            }

            function updateInventory() {
                inventoryContent.innerHTML = "";
                if (hasWoodSword) {
                    const item = document.createElement("div");
                    item.textContent = "Espada de madera (Activa: +1 moneda por toque)";
                    inventoryContent.appendChild(item);
                } else {
                    inventoryContent.textContent = "Inventario vacÃ­o";
                }
            }

            closeInventoryBtn.onclick = () => {
                inventoryPanel.style.display = "none";
            };

            // --- Atajos de teclado ---
            document.addEventListener("keydown", (e) => {
                const key = e.key.toLowerCase();
                if (key === "i") toggleInventory();
                if (key === "m" && gameActive) menuButton.click();
            });

            // --- Iniciar ---
            loadProgress();
        </script>
    </body>
</html> 
